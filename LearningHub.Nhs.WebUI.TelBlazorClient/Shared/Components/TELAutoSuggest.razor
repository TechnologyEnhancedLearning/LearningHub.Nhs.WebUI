@page "/telautosuggest"
@using System.Net.Http.Json
@using LearningHub.Nhs.WebUI.TelBlazorClient.Services
@using TELBlazor.Components
@inject AppSettingsService Api

<h3>AutoSuggest demo (WASM)</h3>

<TELBlazor.Components.Components.BaseComponents.TELAutoSuggestTextbox SearchProvider="SearchItemsAsync" OnSelected="OnSelected" />
@* <AutoSuggest SearchProvider="SearchItemsAsync" OnSelected="OnSelected" /> *@

<p>Selected: <strong>@Selected</strong></p>

@code {
    private string Selected = "";
    private List<string>? Suggestions;

    private async Task<List<string>> SearchItemsAsync(string q)
    {
        await Task.Delay(100); // simulate latency
        try
        {
            Suggestions = await Api.GetAutoSuggestionsAsync(q);
        }
        catch (HttpRequestException httpEx)
        {
            Console.Error.WriteLine($"HTTP Error: {httpEx.Message}");
        }
        catch (NotSupportedException)
        {
            Console.Error.WriteLine("The server returned a non-JSON response.");
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"AutoSuggest Error: {ex.Message}");
        }
        return Suggestions;
    }

    private void OnSelected(string s) => Selected = s;
}

